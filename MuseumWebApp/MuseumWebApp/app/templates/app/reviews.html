{% extends "app/layout.html" %}

{% block content %}
{% load static %}

<head>
    <link rel="stylesheet" href="{% static 'app/content/reviews.css' %}">
</head>

<body>
    <div class="container-box">
        <h1>{{ title }}</h1>

        {% if user.is_authenticated and not is_employee %}
        <button id="showReviewButton" onclick="toggleReviewForm()" class="add-review-button">
            Add Review
        </button>
        {% elif not user.is_authenticated %}
        <button class="add-review-button" onclick="window.location.href='{% url 'login' %}'">
            Add Review (Login Required)
        </button>
        {% endif %}

        <div id="reviewForm" class="review-form">
            <form action="{% url 'create_review' %}" method="POST">
                {% csrf_token %}
                <div class="form-group">
                    <label for="rating">Rating:</label>
                    <select name="rating" id="rating" required>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="text">Review:</label>
                    <textarea name="text" id="text" rows="4" required></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="save-button">Save</button>
                    <button type="button" class="cancel-button" onclick="toggleReviewForm()">Cancel</button>
                </div>
            </form>
        </div>

        <ul class="reviews-list">
            {% for review in reviews %}
            <li class="review-item">
                <h3>Review by {{ review.user.username }}</h3>
                <div class="rating-stars">
                    {% for i in range_stars %}
                    {% if i <= review.rating %}
                    <span class="star filled">★</span>
                    {% else %}
                    <span class="star">☆</span>
                    {% endif %}
                    {% endfor %}
                </div>
                <p>{{ review.text }}</p>
                <small class="review-date">{{ review.created_at|date:"d M Y H:i" }}</small>

                {% if user.is_authenticated and review.user == user %}
                <div class="div-between">
                    <a href="{% url 'edit_review' review.id %}" class="positive-button">Edit</a>
                    <a href="{% url 'delete_review' review.id %}" class="positive-button delete" onclick="return confirm('Are you sure you want to delete this review?');">Delete</a>
                </div>
                    
                {% endif %}
            </li>
            {% endfor %}
        </ul>
    </div>

    <script>
        window.onload = function () {
            document.getElementById("reviewForm").style.display = "none"; 
        };

        function toggleReviewForm() {
            var form = document.getElementById("reviewForm");
            var button = document.getElementById("showReviewButton");
            if (form.style.display === "none" || form.style.display === "") {
                form.style.display = "block";
                button.style.display = "none";
            } else {
                form.style.display = "none";
                button.style.display = "block";
            }
        }
    </script>
</body>
{% endblock %}